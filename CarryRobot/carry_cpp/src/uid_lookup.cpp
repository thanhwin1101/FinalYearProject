#include "uid_lookup.h"
#include "config.h"

// =========================================
// UID-TO-NODE MAPPING
// =========================================
static const struct { uint8_t uid[7]; uint8_t len; const char* node; } UID_MAP[] = {
  // Hallway
  { { 0x04, 0x38, 0x1A, 0xD2, 0x06, 0x00, 0x00 }, 7, "H_MED" },
  { { 0x04, 0x2A, 0x1A, 0xD2, 0x06, 0x00, 0x00 }, 7, "H_BOT" },
  { { 0x04, 0x10, 0x19, 0xD2, 0x06, 0x00, 0x00 }, 7, "H_TOP" },
  // Junction
  { { 0x04, 0x22, 0x1A, 0xD2, 0x06, 0x00, 0x00 }, 7, "J4" },
  { { 0xB3, 0x88, 0x93, 0x0E },                   4, "J1" },
  { { 0x04, 0xDF, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "J2" },
  { { 0x04, 0x3F, 0x1A, 0xD2, 0x06, 0x00, 0x00 }, 7, "J3" },
  // Room 4 (M side)
  { { 0x04, 0x30, 0x1A, 0xD2, 0x06, 0x00, 0x00 }, 7, "R4M1" },
  { { 0x04, 0x1E, 0x19, 0xD2, 0x06, 0x00, 0x00 }, 7, "R4M2" },
  { { 0x04, 0x88, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R4M3" },
  // Room 4 (O side)
  { { 0x04, 0x16, 0x19, 0xD2, 0x06, 0x00, 0x00 }, 7, "R4O1" },
  { { 0x04, 0xE6, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R4O2" },
  { { 0x04, 0x0E, 0x19, 0xD2, 0x06, 0x00, 0x00 }, 7, "R4O3" },
  // Room 4 doors
  { { 0x04, 0xFD, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R4D1" },
  { { 0x04, 0x80, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R4D2" },
  // Room 3 (M side)
  { { 0x04, 0x06, 0x19, 0xD2, 0x06, 0x00, 0x00 }, 7, "R3M1" },
  { { 0x04, 0x96, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R3M2" },
  { { 0x04, 0x47, 0x1A, 0xD2, 0x06, 0x00, 0x00 }, 7, "R3M3" },
  // Room 3 (O side)
  { { 0x04, 0x9E, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R3O1" },
  { { 0x04, 0xCF, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R3O2" },
  { { 0x04, 0xA6, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R3O3" },
  // Room 3 doors
  { { 0x04, 0xF5, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R3D1" },
  { { 0x04, 0xED, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R3D2" },
  // Room 2 (M side)
  { { 0x04, 0xC7, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R2M1" },
  { { 0x04, 0xB7, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R2M2" },
  { { 0x04, 0xBF, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R2M3" },
  // Room 2 (O side)
  { { 0x04, 0xD7, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R2O1" },
  { { 0x04, 0xAE, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R2O2" },
  { { 0x04, 0xFE, 0x18, 0xD2, 0x06, 0x00, 0x00 }, 7, "R2O3" },
  // Room 2 doors
  { { 0x04, 0x78, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R2D1" },
  { { 0x04, 0x70, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R2D2" },
  // Room 1 (M side)
  { { 0x04, 0x68, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R1M1" },
  { { 0x04, 0x60, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R1M2" },
  { { 0x04, 0x50, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R1M3" },
  // Room 1 (O side)
  { { 0x04, 0x58, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R1O1" },
  { { 0x04, 0x48, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R1O2" },
  { { 0x04, 0x40, 0x17, 0xD2, 0x06, 0x00, 0x00 }, 7, "R1O3" },
  // Room 1 doors
  { { 0x04, 0xF6, 0x18, 0xD2, 0x06, 0x00, 0x00 }, 7, "R1D1" },
  { { 0x04, 0xEE, 0x18, 0xD2, 0x06, 0x00, 0x00 }, 7, "R1D2" },
};
static const int UID_MAP_SIZE = sizeof(UID_MAP) / sizeof(UID_MAP[0]);

const char* uidLookupByNodeId(const uint8_t* uid, uint8_t len) {
  for (int i = 0; i < UID_MAP_SIZE; i++) {
    if (UID_MAP[i].len == len && memcmp(UID_MAP[i].uid, uid, len) == 0) {
      return UID_MAP[i].node;
    }
  }
  return nullptr;
}
